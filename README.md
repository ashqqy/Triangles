# 3D Треугольники

## Задача

Со стандартного ввода приходит число $0 < N < 1000000$, а потом $N$ наборов
точек, представляющих трёхмерные треугольники. Необходимо вывести номера
всех треугольников, которые пересекаются с каким-либо другим.

## Решение

За основу взят алгоритм, описанный Томасом Мёллером (Tomas Möller) в [данном](http://web.stanford.edu/class/cs277/resources/papers/Moller1997b.pdf) документе. Предоставлю ниже вольный перевод данной статьи.

В решении буду использовать следующие обозначения:

* $\left( x, y, z \right)$ - вектор (точка) с соответствующими координатами
* $\left(\vec{X}, \vec{Y}\right)$ - скалярное произведение двух векторов
* $\left[\vec{X}, \vec{Y} \right]$ - векторное произведение двух векторов

Обозначим два треугольника за $T$ и $T'$. Вершины $T$ и $T'$ обозначим за $V_0, V_1, V_2$ и $V_0', V_1', V_2'$ соответственно. Плоскости, в которых лежат треугольники, обозначим за $\pi$ и $\pi'$.

<div align="center"> <img src="./img/triangles_algorithm_img.jpg" width="50%"> </div>

Пусть плоскость $\pi$ задана уравнением $Ax + By + Cz + D = 0$. Перепишем это уравнение в более удобном для нас виде:

$$
\pi: Ax + By + Cz + D = 0 \Rightarrow
$$
$$
\pi: (A,B,C) \cdot (x,y,z) + D = 0 \Rightarrow
$$
$$
\pi: (\vec{N}, \vec{X}) + d = 0, где
$$

* $\vec{N} = \left[\vec{V_1} - \vec{V_0}, \vec{V_2} - \vec{V_0}\right]$ - нормаль к плоскости $\pi$,

* $X \in \pi$ - произвольная точка,

* $d = -\left(\vec{N}, \vec{V_0}\right)$.

Теперь найдем расстояния от треугольника $T'$ до плоскости $\pi$. Для этого просто подставим вершины треугольника $T'$ в уравнение плоскости $\pi$:

$d_{V_i'} := \rho \left(\vec{V_i'}, \pi \right) = \left(\vec{N}, \vec{V_i'} \right) + d, i = 0, 1, 2$

Теперь, если все $d_{V_i'} \neq 0$ (то есть точки не лежат на плоскости), и все имеют один и тот же знак, тогда $T'$ лежит по одну сторону от $\pi$ и, значит, **треугольники не пересекаются**. То же верно для треугольника $T$ и плоскости $\pi'$.

Эти две проверки позволяют избежать большого количества вычислений для некоторых пар треугольников.
